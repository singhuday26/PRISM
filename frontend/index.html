<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PRISM Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0b1021;
        --panel: #121831;
        --panel-strong: #0e1429;
        --text: #e8ecf5;
        --muted: #a5b0c7;
        --accent: #4ad1c8;
        --accent-2: #7c6ff1;
        --border: rgba(255, 255, 255, 0.08);
        --shadow: 0 20px 70px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: "DM Sans", system-ui, -apple-system, sans-serif;
        color: var(--text);
        background: radial-gradient(
            circle at 20% 20%,
            rgba(74, 209, 200, 0.15),
            transparent 35%
          ),
          radial-gradient(
            circle at 80% 0%,
            rgba(124, 111, 241, 0.18),
            transparent 25%
          ),
          var(--bg);
      }

      .page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 20px 64px;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 28px;
      }

      .brand {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .brand-badge {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        box-shadow: 0 10px 30px rgba(74, 209, 200, 0.25);
        display: grid;
        place-items: center;
        font-weight: 700;
        color: #0b1021;
        letter-spacing: 0.5px;
      }

      .brand h1 {
        margin: 0;
        font-family: "Space Grotesk", "DM Sans", sans-serif;
        font-size: 1.4rem;
        letter-spacing: -0.03em;
      }

      .brand small {
        color: var(--muted);
      }

      .pill {
        padding: 10px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--border);
        color: var(--muted);
        font-size: 0.9rem;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
      }

      .panel {
        background: linear-gradient(145deg, var(--panel), var(--panel-strong));
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 18px;
      }

      .panel h2 {
        margin: 0 0 12px;
        font-size: 1.1rem;
        font-weight: 600;
        letter-spacing: -0.01em;
      }

      .stat-line {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .stat-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
      }

      .hotspot-list {
        display: grid;
        gap: 12px;
      }

      .hotspot-card {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 12px 12px;
        background: rgba(255, 255, 255, 0.02);
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        transition: transform 150ms ease, border-color 150ms ease;
      }

      .hotspot-card:hover {
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.14);
      }
      .hotspot-meta {
        color: var(--muted);
        font-size: 0.9rem;
      }
      .hotspot-value {
        font-size: 1.2rem;
        font-weight: 600;
      }
      .badge {
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(74, 209, 200, 0.18);
        color: var(--text);
        border: 1px solid rgba(74, 209, 200, 0.4);
        font-size: 0.85rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        color: var(--text);
        font-size: 0.95rem;
      }

      th,
      td {
        text-align: left;
        padding: 12px 10px;
      }

      th {
        color: var(--muted);
        font-weight: 500;
      }

      tbody tr {
        border-top: 1px solid var(--border);
      }
      tbody tr:hover {
        background: rgba(255, 255, 255, 0.03);
      }

      .muted {
        color: var(--muted);
      }
      .error {
        color: #ff8a9c;
        font-weight: 600;
      }

      .hero {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 16px;
        margin-bottom: 18px;
      }

      .hero .headline {
        font-size: 1.5rem;
        margin: 0 0 8px;
        font-family: "Space Grotesk", "DM Sans", sans-serif;
      }
      .hero p {
        margin: 0;
        color: var(--muted);
        line-height: 1.5;
      }

      .sparkline {
        width: 100%;
        height: 80px;
        border-radius: 12px;
        background: linear-gradient(
          135deg,
          rgba(124, 111, 241, 0.2),
          rgba(74, 209, 200, 0.18)
        );
        mask-image: linear-gradient(
          transparent,
          black 20%,
          black 80%,
          transparent
        );
        position: relative;
        overflow: hidden;
      }

      .sparkline::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.06) 0%,
          rgba(255, 255, 255, 0) 40%
        );
        animation: shimmer 8s linear infinite;
      }

      @keyframes shimmer {
        from {
          transform: translateX(-100%);
        }
        to {
          transform: translateX(100%);
        }
      }

      @media (max-width: 820px) {
        .hero {
          grid-template-columns: 1fr;
        }
        header {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div class="brand">
          <div class="brand-badge">PR</div>
          <div>
            <h1>PRISM Dashboard</h1>
            <small>Live view of regions and hotspots</small>
          </div>
        </div>
        <div class="pill" id="clock">Loading time…</div>
      </header>

      <section class="hero">
        <div class="panel">
          <p class="headline">Track outbreak hotspots and regional coverage.</p>
          <p>
            Data comes straight from the PRISM API. Use this starter UI to
            validate endpoints and experiment with layouts before investing in a
            full design system.
          </p>
        </div>
        <div class="panel">
          <h2 class="stat-line"><span class="stat-dot"></span> System pulse</h2>
          <div class="sparkline" aria-hidden="true"></div>
          <p class="muted" style="margin-top: 10px">
            Endpoints: /health, /regions, /hotspots
          </p>
        </div>
      </section>

      <div class="grid">
        <div class="panel" id="hotspots-panel">
          <h2>Hotspots</h2>
          <div class="hotspot-list" id="hotspot-list">
            <p class="muted">Loading hotspots…</p>
          </div>
        </div>

        <div class="panel">
          <h2>Regions</h2>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Region</th>
                  <th>ID</th>
                </tr>
              </thead>
              <tbody id="regions-body">
                <tr>
                  <td colspan="2" class="muted">Loading regions…</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      const hotspotList = document.getElementById("hotspot-list");
      const regionsBody = document.getElementById("regions-body");
      const clock = document.getElementById("clock");
      const apiBase = window.location.origin;

      function prettyDate(dateStr) {
        const parsed = new Date(dateStr);
        if (Number.isNaN(parsed.getTime())) return dateStr || "-";
        return parsed.toLocaleDateString(undefined, {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      async function loadHotspots() {
        try {
          const res = await fetch(`${apiBase}/hotspots?limit=6`);
          if (!res.ok) throw new Error(`Failed hotspots: ${res.status}`);
          const data = await res.json();
          const hotspots = data.hotspots || [];
          if (!hotspots.length) {
            hotspotList.innerHTML = '<p class="muted">No hotspot data yet.</p>';
            return;
          }

          hotspotList.innerHTML = hotspots
            .map((h, idx) => {
              const confirmed =
                h.confirmed_sum?.toLocaleString?.() ?? h.confirmed_sum ?? "-";
              const deaths =
                h.deaths_sum?.toLocaleString?.() ?? h.deaths_sum ?? "-";
              const date = prettyDate(h.latest_date);
              const regionName = h.region_name || "Unknown region";
              return `
            <article class="hotspot-card">
              <div>
                <div class="hotspot-meta">#${idx + 1} • ${regionName}</div>
                <div class="hotspot-value">${confirmed} confirmed</div>
                <div class="muted">${deaths} deaths</div>
              </div>
              <div class="badge">Updated ${date}</div>
            </article>
          `;
            })
            .join("");
        } catch (err) {
          hotspotList.innerHTML = `<p class="error">${err.message}</p>`;
        }
      }

      async function loadRegions() {
        try {
          const res = await fetch(`${apiBase}/regions/`);
          if (!res.ok) throw new Error(`Failed regions: ${res.status}`);
          const data = await res.json();
          const regions = data.regions || [];
          if (!regions.length) {
            regionsBody.innerHTML =
              '<tr><td colspan="2" class="muted">No regions yet.</td></tr>';
            return;
          }
          regionsBody.innerHTML = regions
            .map(
              (r) => `
          <tr>
            <td>${r.region_name || "Unnamed"}</td>
            <td class="muted">${r.region_id}</td>
          </tr>
        `
            )
            .join("");
        } catch (err) {
          regionsBody.innerHTML = `<tr><td colspan="2" class="error">${err.message}</td></tr>`;
        }
      }

      function startClock() {
        const update = () => {
          const now = new Date();
          clock.textContent =
            now.toLocaleString(undefined, {
              hour: "2-digit",
              minute: "2-digit",
              second: "2-digit",
            }) +
            " • " +
            now.toDateString();
        };
        update();
        setInterval(update, 1000);
      }

      startClock();
      loadHotspots();
      loadRegions();
    </script>
  </body>
</html>
